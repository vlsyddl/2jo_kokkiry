<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.assa.repository.mapper.TodoListMapper">
	<resultMap id="todoMap" type="TodoList">
		<result column="board_no" property="boardNo" />
		<result column="todo_no" property="todoNo" />
		<result column="todo_check" property="todoCheck" />
	</resultMap>
	<resultMap id="boardMap" type="board">
			<result column="no" property="no" />
			<result column="writer" property="writer" />
			<result column="title" property="title" />
			<result column="content" property="content" />
			<result column="reg_date" property="regDate" />
			<result column="count" property="count" />
			<result column="category" property="category" />
<!-- 		<collection property="Comment" resultMap="commentMap" ></collection> -->
	</resultMap>
	<resultMap type="Comment" id="commentMap">
		<result column="comment_no" property="commentNo" />
		<result column="board_no" property="boardNo" />
		<result column="comment_writer" property="commentWriter" />
		<result column="comment_content" property="commentContent" />
		<result column="comment_reg_date" property="commentRegDate" />
	</resultMap>
	<resultMap type="TodoBoard" id="todoBoardMap">
		<result column="reg_date" property="regDate" />
		<result column="todo_check" property="todoCheck" />
	</resultMap>
	
	
	<!-- 전체 목록 가져오기 -->
	<select id="selectDaily" resultMap="boardMap">
		select *
		  from assa_board
		  where category = #{category}
		 order by no desc 
	</select>
	
<!-- 	select date_format(reg_date, '%Y%m%d') as reg_date -->
<!--   from assa_board; -->
	
	
	<select id="selectComment" parameterType="int" resultMap="commentMap">
		select *
		 from assa_comment
		where board_no= #{boardNo}
		order by comment_no desc
	</select>

	 <!-- 일상 게시판 글 + 댓글 --> 
<!-- 	<select id="selectComment" resultMap="boardMap"> -->
<!-- 	select  * -->
<!-- 	 from assa_board b -->
<!-- 	 left outer join assa_comment c -->
<!-- 	  on b.no = c.board_no -->
<!--      where b.category = 2 -->
<!--      and b.no = c.board_no -->
<!--     order by b.no desc -->
<!-- 	</select> -->
	

	
	<!-- 게시물 등록하기 : insertBoard -->
	<insert id="insertDaily" parameterType="board">
		insert into assa_board(
			 title, writer, content, category 
		) values (
			 #{title}, #{writer}, #{content}, 2
		)
	</insert>
	
	<!-- 댓글 등록 -->
	<insert id="insertComment" parameterType="Comment">
		insert into
		assa_comment(
		board_no, comment_writer, comment_content
		)values(
		#{boardNo}, #{commentWriter}, #{commentContent}
		)
	</insert>
	
	<!--  댓글 삭제 -->
	<delete id="deleteComment" parameterType="int">
    	delete 
    	  from assa_comment
    	 where comment_no = #{commentNo}
    </delete>
	
	
	
	
	<!-- 게시물 삭제 -->
    <select id="selectDailyByNo" parameterType="int" resultMap="boardMap">
    	select *
    	  from assa_board
    	 where no = #{no} 
    </select>	
    	
    <delete id="deleteDaily" parameterType="int">
    	delete 
    	  from assa_board
    	 where no = #{no}
    </delete>
        
    
    
    <update id="updateBoard" parameterType="board">
    	update assa_board
    	   set title = #{title},
    	       content = #{content}
    	 where no = #{no}
    </update>	 
    
    
    
    
    
    


	<update id="updateComment" parameterType="int">
		update assa_comment
		set content = #{content}
		where comment_no = #{commentNo}
	</update>

	<!-- 게시글 추천수 -->
	<select id="rec" resultType="int">
		select count(*)
		from assa_recomm
		where no=#{no}
	</select>

	<!-- 추천여부 확인 -->
	<select id="recCount" resultType="int" parameterType="Recomm">
		select
		count(*)
		from assa_recomm
		where no=#{no}
		and recomm_name=#{recommName}
	</select>

	<!-- 추천하기 -->
	<insert id="insertRec" parameterType="Recomm">
		insert into assa_recomm(
		no, recomm_name
		) values (
		#{no}, #{recommName}
		)
	</insert>

	<!-- 추천취소 -->
	<delete id="deleteRec" parameterType="Recomm">
		delete assa_recomm
		where
		no=#{no}
		and recomm_name= #{recommName}
	</delete>
	
	
	
	
	
	



	<!-- todo list -->
	<!-- todo 리스트 -->

	<select id="selectTodoList" parameterType="TodoBoard" resultMap="todoBoardMap">
		select b.writer, b.title, t.todo as todo, b.reg_date, b.no,
		t.todo_check
		from assa_board b inner join assa_todo t
		on b.no = t.board_no
		where date_format(b.reg_date, '%Y%m%d') = date_format(now(), '%Y%m%d')
	</select>
	
	<select id="selectTodoListByNo" parameterType="int" resultMap="todoBoardMap">
		select b.writer, b.title, t.todo as todo, b.reg_date, b.no,
		t.todo_check
		from assa_board b inner join assa_todo t
		on b.no = t.board_no
		where no = #{no}
	</select>
	
	
	
	<!-- todo 등록 -->
	<insert id="insertTitle" parameterType="Board" useGeneratedKeys="true"
		keyProperty="no">
		insert into assa_board(
		title , writer, category
		)values(
		#{title}, #{writer}, 4
		)
	</insert>
	<insert id="insertTodo" parameterType="TodoList">
		insert into
		assa_todo(
		board_no, todo
		) value(
		#{boardNo}, #{todo}
		)
	</insert>

	

</mapper>

























